---
import CTASection from '../components/home/CTASection.astro';
import FeaturedDealsSection from '../components/home/FeaturedDealsSection.astro';
import FeaturesSection from '../components/home/FeaturesSection.astro';
/**
 * Home Page
 * 首页 - 整合分类、搜索、商品展示等功能
 */
import HomePageHero from '../components/home/HomePageHero.astro';
import CategoryGrid from '../components/modules/CategoryGrid.astro';
import ProductListModule from '../components/modules/ProductListModule.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import { mockService } from '../lib/mock/service';

// Get initial data
const categories = mockService.getCategories();
const featuredDeals = mockService.getFeaturedDeals();
const initialProducts = mockService.getProducts({
  searchQuery: '',
  category: '',
  sort: 'relevance',
  page: 1,
  limit: 12,
});

const availableFilters = {
  categories: categories.map((c) => c.name),
  platforms: ['Amazon', '楽天', 'Yahoo!ショッピング'],
  priceRanges: [
    '〜10,000円',
    '10,001円〜50,000円',
    '50,001円〜100,000円',
    '100,001円〜',
  ],
};

// Define metadata for the page
const metadata = {
  title: 'UMUO - 賢い買い物、スマートな価格比較',
  description:
    'Amazon、楽天、Yahoo!ショッピングなど主要ECサイトの価格をリアルタイムで比較。',
};
---

<BaseLayout
  title="UMUO - 賢い買い物、スマートな価格比較"
  description="Amazon、楽天、Yahoo!ショッピングなど主要ECサイトの価格をリアルタイムで比較。"
>
  <!-- Hero Section -->
  <HomePageHero />

  <!-- Categories Grid Module - Top Section -->
  <CategoryGrid categories={categories} />

  <!-- Product List Module - Search, Filters, Products -->
  <ProductListModule
    initialProducts={initialProducts.products}
    initialPagination={initialProducts.pagination}
    availableFilters={availableFilters}
    searchQuery=""
    initialCategory=""
  />

  <!-- Featured Deals -->
  <FeaturedDealsSection featuredDeals={featuredDeals} />

  <!-- Features Grid -->
  <FeaturesSection />

  <!-- CTA Section -->
  <CTASection />

  <!-- Global data for client-side components -->
  <script define:vars={{ initialProducts: initialProducts.products, initialPagination: initialProducts.pagination, availableFilters }}>
    window.__INITIAL_PRODUCTS__ = initialProducts;
    window.__INITIAL_PAGINATION__ = initialPagination;
    window.__AVAILABLE_FILTERS__ = availableFilters;
  </script>
</BaseLayout>
